head	6.34;
branch	6.34.0;
access;
symbols;
locks; strict;
comment	@ * @;


6.34
date	2007.10.18.18.28.33;	author ceswbl2;	state Exp;
branches
	6.34.0.1;
next	6.33;

6.33
date	2007.04.23.17.04.24;	author ceswbl2;	state Exp;
branches
	6.33.0.1;
next	6.32;

6.32
date	2006.10.25.17.25.06;	author ceswbl2;	state Exp;
branches
	6.32.0.1;
next	6.31;

6.31
date	2006.04.13.19.15.43;	author ceswbl2;	state Exp;
branches
	6.31.0.1;
next	6.30;

6.30
date	2005.10.11.20.27.03;	author ceswbl2;	state Exp;
branches
	6.30.0.1;
next	6.29;

6.29
date	2004.12.02.19.28.44;	author ceswbl2;	state Exp;
branches
	6.29.0.1;
next	6.28;

6.28
date	2004.06.10.19.26.15;	author ceswbl2;	state Exp;
branches
	6.28.0.1;
next	6.27;

6.27
date	2003.12.16.21.07.24;	author ceswbl2;	state Exp;
branches
	6.27.0.1;
next	6.26;

6.26
date	2003.08.13.20.10.40;	author ceswbl2;	state Exp;
branches
	6.26.0.1;
next	6.25;

6.25
date	2003.07.25.13.34.53;	author ceswbl2;	state Exp;
branches
	6.25.0.1;
next	6.24;

6.24
date	2003.03.03.20.56.01;	author fran;	state Exp;
branches
	6.24.0.1;
next	;

6.24.0.1
date	2003.03.03.20.56.19;	author fran;	state Exp;
branches;
next	;

6.25.0.1
date	2003.07.25.13.35.11;	author ceswbl2;	state Exp;
branches;
next	;

6.26.0.1
date	2003.08.14.19.26.37;	author cwbl2tst;	state Exp;
branches;
next	;

6.27.0.1
date	2003.12.17.17.56.52;	author ceswbl2;	state Exp;
branches;
next	;

6.28.0.1
date	2004.06.11.14.17.57;	author ceswbl2;	state Exp;
branches;
next	;

6.29.0.1
date	2004.12.03.14.35.22;	author ceswbl2;	state Exp;
branches;
next	;

6.30.0.1
date	2005.10.12.16.54.04;	author ceswbl2;	state Exp;
branches;
next	;

6.31.0.1
date	2006.04.14.14.52.45;	author ceswbl2;	state Exp;
branches;
next	;

6.32.0.1
date	2006.10.26.16.06.09;	author ceswbl2;	state Exp;
branches;
next	;

6.33.0.1
date	2007.04.24.16.31.07;	author ceswbl2;	state Exp;
branches;
next	6.33.0.2;

6.33.0.2
date	2007.10.12.11.42.38;	author tallman;	state Exp;
branches;
next	;

6.34.0.1
date	2007.10.19.14.29.49;	author ceswbl2;	state Exp;
branches;
next	;


desc
@@


6.34
log
@CESWBL2_6_34_OCT_18_07
@
text
@/* dosFsLib.h - DOS file system header file */


/*
modification history
--------------------
01f,31aug99,jkf  changes for new CBIO API.
01e,31jul99,jkf  T2 merge, tidiness & spelling.
01d,15oct98,lrn  moved 64-bit extended ioctl codes to ioLib.h
01c,11sep98,vld  prototype of dosFsDevCreate() to accept arbitrary
		 block device ptr.
01d,09jul98,lrn  added more defines for back compatibility
01c,30jun98,lrn  moved ERRNO_PX_FLAG to errno.h, renamed dosFsInit to
                 dosFsLibInit, added b.c., cosmetics
01b,28jun98,vld  tested and checked in
01a,22jan98,vld  written,
*/

#ifndef __INCdoFsLib
#define __INCdoFsLib

#include <blkIo.h>
#include <iosLib.h>

#ifdef __cplusplus
extern "C" {
#endif

#define DOS_OPT_AUTOSYNC        0x2     /* autoSync mode enabled */
#define DOS_OPT_LONGNAMES       0x4    
#define DOS_OPT_DEFAULT         0x0000  /* format with default options */
#define DOS_OPT_PRESERVE        0x0001  /* preserve boot block if possible */
#define DOS_OPT_BLANK           0x0002  /* create a clean boot block */
#define DOS_OPT_QUIET           0x0004  /* dont produce any output */
#define DOS_OPT_FAT16           0x0010  /* format with FAT16 file system */
#define DOS_OPT_FAT32           0x0020  /* format with FAT32 file system */
#define DOS_OPT_VXLONGNAMES     0x0100  /* format with VxLong file names */

#define DOS_LONG_NAME_LEN	40	/* length of filename w/ long option */
#define	DOS_EXT_LEN		3	/* length of filename extension */
#define DOS_LONG_RESERVED_LEN	13	/* reserved bytes in longNames dir ent*/
#define	DOS_SYS_ID_LEN		8	/* length of system ID string */
#define DOS_NAME_LEN		8	/* length of filename (no extension) */
#define	DOS_VOL_LABEL_LEN	(DOS_NAME_LEN + DOS_EXT_LEN)

typedef struct dosDirEnt	/* DOS_DIR_ENT */
    {
    int			dosde_hashNode;	        /* hash node for dir entry */
    void		*dosde_pNext;		/* ptr to next dir entry */
    void		*dosde_pParent;		/* ptr to parent dir entry */
    void		*dosde_pSubDir;		/* ptr to entry chain, if dir */
    UINT8		dosde_name [DOS_LONG_NAME_LEN]; /* filename */
    UINT8		dosde_ext [DOS_EXT_LEN];   /* filename extension */
    UINT8		dosde_attrib;		/* attribute byte */
    char		dosde_reserved[DOS_LONG_RESERVED_LEN];	/* reserved*/
    USHORT		dosde_time;		/* time */
    USHORT		dosde_date;		/* date */
    USHORT		dosde_cluster;		/* starting cluster number */
    ULONG		dosde_size;		/* file size (in bytes) */
    BOOL		dosde_modified;		/* flag set if dir changed */
    } DOS_DIR_ENT;

typedef struct		/* DOS_VOL_DESC */
    {
    DEV_HDR	dosvd_devHdr;		/* i/o system device header */
    short	dosvd_status;		/* (OK | ERROR) */
    char	dosvd_sysId [DOS_SYS_ID_LEN];	/* system ID string */
    SEM_ID	dosvd_semId;		/* volume semaphore id */

    BLK_DEV	*dosvd_pBlkDev;		/* pointer to block device info */

    char	dosvd_mediaByte;	/* media format byte */
    UINT8	dosvd_secPerClust;	/* number of sectors per cluster */
    UINT	dosvd_bytesPerClust;	/* bytes-per-cluster */

    UINT8	dosvd_nFats;		/* number of copies of FAT */
    UINT16	dosvd_secPerFat;	/* number of sectors per FAT */
    int		dosvd_nFatEnts;		/* number of entries in FAT */
    BOOL	dosvd_fat12Bit;		/* FAT uses 12 (vs. 16) bit entries */
    BOOL	dosvd_fatModified;	/* TRUE if FAT has been changed */
    UINT8	*dosvd_pFatBuf;		/* pointer to FAT buffer */
    int		dosvd_fatEntFreeCnt;	/* count of free clusters */

    USHORT	dosvd_maxRootEnts;	/* max num of root directory entries */
    ULONG	dosvd_nRootEnts;	/* current num of root dir entries */
    int		dosvd_rootSec;		/* starting sector number of root dir */
    DOS_DIR_ENT	*dosvd_pRoot;		/* pointer to root directory entry */

    USHORT	dosvd_nResrvdSecs;	/* number of reserved sectors */
    ULONG	dosvd_nHiddenSecs;	/* number of hidden sectors */
    UINT	dosvd_dataSec;		/* starting sector number of data area*/

    UINT8	dosvd_driveNum;		/* physical drive number */
    UINT8	dosvd_bootSigRec;	/* extended boot signature record */
    ULONG	dosvd_volId;		/* binary volume ID number */
    char	dosvd_volLabel [DOS_VOL_LABEL_LEN];
					/* volume label string */

    int		dosvd_state;		/* state of volume (see below) */
    int		dosvd_retry;		/* retry count of disk operations */
    UINT	dosvd_options;		/* volume options (see below) */

    UINT8	*dosvd_pFatModTbl;	/* ptr to table of mod'd FAT sectors */
    void	*dosvd_hashTbl;	        /* hash table for volume */
    int         dosvd_uid;	        /* user id to report from stat () */
    int         dosvd_gid;              /* group id to report from stat () */
    int         dosvd_mode;	        /* file mode to report from stat () */
    } DOS_VOL_DESC;

typedef struct          /* DOS_VOL_CONFIG */
    {                           /* Legend: M- modifiable, C- Calculated */
    enum
        { _AUTO=0, _FAT12=12, _FAT16=16, _FAT32=32 }
                fatType;        /* M- Fat format Type */
    const char * sysId ;        /* M- sys ID string */
    int         secPerClust;    /* M- sectors per cluster (minimum 1) */
    short       nResrvd;        /* M- number of reserved sectors (min 1) */
    short       maxRootEnts;    /* M- max number of entries in root dir */
    char        nFats;          /* M- number of FAT copies (minimum 1) */
    ULONG       secPerFat;      /* C- number of sectors per FAT copy */
    ULONG       nClust;         /* C- # of clusters on disk */
    ULONG       nHidden;        /* C- number of hidden sectors */
    ULONG       volSerial ;     /* M- disk serial number */
    int         secPerTrack;    /* M- sectors per track */
    char        nHeads;         /* M- number of heads */
    char        mediaByte;      /* M- media descriptor byte */
    char        volLabel[ 11 ]; /* X- disk volume label */
    } DOS_VOL_CONFIG;

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
STATUS 
dosFsInit (
	int maxFiles
);

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
DOS_VOL_DESC *
dosFsDevInit (
	char *devName,
	BLK_DEV *pBlkDev,
	DOS_VOL_CONFIG *pConfig
);

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
DOS_VOL_DESC *
dosFsMkfs (
	char *volName,
	BLK_DEV *pBlkDev
);

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
STATUS
dosFsVolUnmount (
	void *dev
);

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
STATUS
dosFsMkfsOptionsSet (
	UINT options
);

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
STATUS 
dosFsVolOptionsSet (
	DOS_VOL_DESC *vdptr,
	UINT options
);

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
STATUS
dosFsConfigInit (
	DOS_VOL_CONFIG	*pConfig,
	char		mediaByte,
	UINT8		secPerClust,
	short		nResrvd,
	char		nFats,
	UINT16		secPerFat,
	short		maxRootEnts,
	UINT		nHidden,
	UINT		options
);

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
STATUS
dosFsDateSet (
	int		year,
	int		month,
	int		day
);

/*
 * @@limitation There isn't really a DOS file system in this POSIX
 * implementation, but this call can still be made. Instead, the
 * Unix file system is (silently) used.
 */
STATUS
dosFsTimeSet (
	int		hour,
	int		minute,
	int		second
);

#ifdef __cplusplus
    }
#endif

#endif /* __INCdoFsLib */

@


6.34.0.1
log
@Making_Branches
@
text
@@


6.33
log
@CESWBL2_6_33_APR_23_07
@
text
@a2 1
/* Copyright 1999 Wind River Systems, Inc. */
@


6.33.0.1
log
@Making_Branches
@
text
@@


6.33.0.2
log
@Removed notices.  IAW TR#2677
@
text
@d3 1
@


6.32
log
@CESWBL2_6_32_OCT_25_06
@
text
@@


6.32.0.1
log
@Making_Branches
@
text
@@


6.31
log
@CESWBL2_6_31_APR_14_06
@
text
@@


6.31.0.1
log
@Making_Branches
@
text
@@


6.30
log
@CESWBL2_6_30_OCT_12_05
@
text
@@


6.30.0.1
log
@Making_Branches
@
text
@@


6.29
log
@CESWBL2_6_29_DEC_03_04
@
text
@@


6.29.0.1
log
@Making_Branches
@
text
@@


6.28
log
@CESWBL2_6_28_JUN_11_04
@
text
@@


6.28.0.1
log
@Making_Branches
@
text
@@


6.27
log
@CESWBL2_6_27_DEC_17_03
@
text
@@


6.27.0.1
log
@Making_Branches
@
text
@@


6.26
log
@CESWBL2_6_26_AUG_13_03
@
text
@@


6.26.0.1
log
@Making_Branches
@
text
@@


6.25
log
@Correcting_RCS_Rev
@
text
@@


6.25.0.1
log
@Making_Branches
@
text
@@


6.24
log
@initial wasp rev
@
text
@@


6.24.0.1
log
@initial wasp rev
@
text
@@
